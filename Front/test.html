<!DOCTYPE html>
<html>
	<head> 
		<meta charset="utf-8" />
		<title>情绪诱发系统V1.0</title> 
		<link rel="stylesheet" type="text/css" href="assets/styles/index.css" />
		<script src="assets/scripts/jquery-3.3.1.min.js" ></script>
		<script src="config.json"></script>
		<script>

			$(document).ready(function() {
				


				$("#btnSend").click(function() {
					var text = $("#text").val();
					
					var data = {
						user: {
							text: text
						},
						data: []
					}

					var websocket = getWebSocket()
					websocket.onopen = function(){
						console.log("hi")		

						websocket.send(JSON.stringify(data))
						//websocket.close()
						alert("发完了")			
					}

					
				})

				$("#btnSendString").click(function() {
					var text = $("#text").val();
					
					var data = {
						user: {
							text: text
						},
						data: []
					}

					var websocket = getWebSocket()

					websocket.onopen = function(){
						console.log("hi")		

						websocket.send(data)
						//websocket.close()
						alert("发完了")			
					}

				})
			})

			function getWebSocket() {
				//var url = "ws://192.168.3.2:8080/mood"
				var url = "ws://localhost:8080/mood"

				var websocket = new WebSocket(url);
				
				websocket.onmessage = function(e) {
					console.log(e)
					var obj = JSON.parse(e.data)
					console.log(obj)
					if (obj.status == 200) {
						alert("保存成功！")
					} else {
						alert("保存失败！")
					}

					websocket.close()
				}

				websocket.onerror = function(e) {
					alert("websocket错误！" + e)
					websocket.close()
				}

				return websocket
			}

		</script>
	</head>
	<body>
		<input id="text" type="text" />
		<input id="btnSend" type="button" value="send" />
		<input id="btnSendString" type="button" value="sendString" />
	</body>
</html>